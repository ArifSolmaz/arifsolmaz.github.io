<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İSTUN Mechatronics Engineering</title>

    <!-- Fonts: Premium Pairing (Outfit + Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Outfit:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        // ╔════════════════════════════════════════════════════════════════════════════╗
        // ║  CONFIGURATION                                                             ║
        // ╚════════════════════════════════════════════════════════════════════════════╝
        const GOOGLE_SHEET_ID = '1MrgcCLRlEUTGaKUI62GcdmlIRqPPwfETx6AREZzpGKI';

        // Exact Tab Names from your Google Sheet
        const SHEETS = {
            settings: 'Settings',
            news: 'News',
            events: 'Events',
            faculty: 'Faculty',
            research: 'Research',
            publications: 'Publications',
            courses: 'Courses',
            projects: 'Projects',
            labs: 'Labs',
            jobs: 'Jobs',
            alumni: 'Alumni',
            partners: 'Partners',
            students: 'Students'
        };
    </script>

    <style>
        /* ════════════════════════════════════════════════════════════════════════════
           DESIGN SYSTEM
           ════════════════════════════════════════════════════════════════════════════ */
        :root {
            /* Palette: Modern Academic Tech (Deep Navy + Vibrant Blue + Clean White) */
            --bg-page: #F8FAFC;
            --bg-white: #ffffff;
            --bg-glass: rgba(255, 255, 255, 0.85);

            --primary: #0F172A;
            /* Slate 900 - Deep professional dark */
            --primary-light: #1E293B;
            /* Slate 800 */

            --accent: #3A46ED;
            /* Vibrant Tech Blue */
            --accent-glow: rgba(58, 70, 237, 0.15);
            --accent-dark: #312E81;

            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;

            --text-main: #0F172A;
            --text-muted: #64748B;
            --text-light: #94A3B8;

            --border: #E2E8F0;
            --border-hover: #CBD5E1;

            --font-display: 'Outfit', sans-serif;
            --font-body: 'Inter', sans-serif;

            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;

            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.06);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-float: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);

            --container-width: 1280px;
            --header-height: 80px;
        }

        /* RESET & BASE */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--bg-page);
            color: var(--text-main);
            margin: 0;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: var(--font-display);
            font-weight: 700;
            margin-top: 0;
            line-height: 1.1;
            color: var(--primary);
        }

        a {
            text-decoration: none;
            color: inherit;
            transition: all 0.2s;
        }

        ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        img {
            max-width: 100%;
            display: block;
        }

        .container {
            max-width: var(--container-width);
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* ════════════════════════════════════════════════════════════════════════════
           UTILITIES & ANIMATIONS
           ════════════════════════════════════════════════════════════════════════════ */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        .skeleton {
            background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius-sm);
        }

        @keyframes shimmer {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        /* ════════════════════════════════════════════════════════════════════════════
           HEADER
           ════════════════════════════════════════════════════════════════════════════ */
        header {
            position: fixed;
            top: 0;
            width: 100%;
            height: var(--header-height);
            z-index: 1000;
            transition: all 0.3s ease;
            background: transparent;
        }

        header.scrolled {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            height: 70px;
        }

        .nav-wrapper {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 100%;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 800;
            font-size: 1.25rem;
            color: var(--primary);
            font-family: var(--font-display);
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--accent);
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(58, 70, 237, 0.3);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-link {
            font-weight: 500;
            font-size: 0.95rem;
            color: var(--text-main);
            position: relative;
        }

        .nav-link:hover {
            color: var(--accent);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--accent);
            transition: width 0.3s;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        /* ════════════════════════════════════════════════════════════════════════════
           HERO SECTION
           ════════════════════════════════════════════════════════════════════════════ */
        .hero {
            position: relative;
            min-height: 90vh;
            display: flex;
            align-items: center;
            padding-top: var(--header-height);
            background: radial-gradient(circle at top right, rgba(58, 70, 237, 0.08), transparent 40%),
                radial-gradient(circle at bottom left, rgba(16, 185, 129, 0.05), transparent 40%);
            overflow: hidden;
        }

        /* Interactive Background Mesh */
        .hero-mesh {
            position: absolute;
            width: 600px;
            height: 600px;
            background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%);
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.6;
            top: -100px;
            right: -100px;
            z-index: -1;
            animation: float 10s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translate(0, 0);
            }

            50% {
                transform: translate(-30px, 40px);
            }
        }

        .hero-content {
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 4rem;
            align-items: center;
        }

        .hero-text h1 {
            font-size: clamp(2.5rem, 5vw, 4rem);
            line-height: 1.1;
            margin-bottom: 1.5rem;
            letter-spacing: -0.02em;
        }

        .hero-text h1 span {
            color: var(--accent);
            position: relative;
            display: inline-block;
        }

        .hero-text p {
            font-size: 1.2rem;
            color: var(--text-muted);
            margin-bottom: 2.5rem;
            max-width: 600px;
        }

        .cta-group {
            display: flex;
            gap: 1rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 0.9rem 1.8rem;
            background: var(--primary);
            color: white;
            border-radius: var(--radius-md);
            font-weight: 600;
            transition: all 0.3s;
            border: 1px solid transparent;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(15, 23, 42, 0.3);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary);
            border-color: var(--border);
        }

        .btn-outline:hover {
            background: white;
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        /* Hero Stats Cards */
        .hero-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            position: relative;
        }

        .stat-card {
            background: var(--bg-glass);
            padding: 2rem;
            border-radius: var(--radius-lg);
            border: 1px solid white;
            box-shadow: var(--shadow-float);
            backdrop-filter: blur(10px);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card:nth-child(2) {
            transform: translateY(30px);
        }

        /* Offset Effect */
        .stat-card:nth-child(2):hover {
            transform: translateY(25px);
        }

        .stat-value {
            font-family: var(--font-display);
            font-size: 3rem;
            font-weight: 800;
            color: var(--accent);
            display: block;
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        .stat-label {
            color: var(--text-muted);
            font-weight: 500;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* ════════════════════════════════════════════════════════════════════════════
           SECTIONS GENERAL
           ════════════════════════════════════════════════════════════════════════════ */
        .section {
            padding: 6rem 0;
            position: relative;
        }

        .section-header {
            margin-bottom: 4rem;
            max-width: 700px;
        }

        .label {
            color: var(--accent);
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 1rem;
            display: block;
        }

        .section-header h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        /* ════════════════════════════════════════════════════════════════════════════
           RESEARCH GRID
           ════════════════════════════════════════════════════════════════════════════ */
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
        }

        .research-card {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border);
            transition: all 0.4s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .research-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-glow);
        }

        .research-img {
            height: 220px;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .research-img::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(15, 23, 42, 0.6), transparent);
        }

        .research-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: white;
            padding: 0.4rem 0.8rem;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.75rem;
            color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        .research-content {
            padding: 2rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .research-content h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .research-content p {
            color: var(--text-muted);
            margin-bottom: 1.5rem;
            flex: 1;
        }

        .research-meta {
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .research-lead {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .research-lead img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        /* ════════════════════════════════════════════════════════════════════════════
           FACULTY & PEOPLE
           ════════════════════════════════════════════════════════════════════════════ */
        .faculty-scroller {
            display: flex;
            gap: 2rem;
            overflow-x: auto;
            padding-bottom: 2rem;
            scrollbar-width: none;
        }

        .faculty-scroller::-webkit-scrollbar {
            display: none;
        }

        .faculty-card {
            min-width: 280px;
            background: white;
            padding: 2rem;
            border-radius: var(--radius-lg);
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .faculty-card:hover {
            border-color: var(--accent);
            box-shadow: var(--shadow-md);
        }

        .faculty-img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            object-fit: cover;
            border: 3px solid var(--bg-page);
            box-shadow: 0 0 0 2px var(--accent);
        }

        .faculty-name {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .faculty-role {
            color: var(--accent);
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 1rem;
        }

        /* ════════════════════════════════════════════════════════════════════════════
           NEWS LIST
           ════════════════════════════════════════════════════════════════════════════ */
        .news-item {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .news-item:hover {
            transform: translateX(10px);
            border-color: var(--accent);
        }

        .news-date {
            background: var(--bg-page);
            border-radius: var(--radius-sm);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            height: 100%;
            color: var(--text-muted);
        }

        .news-date b {
            font-size: 2rem;
            color: var(--primary);
            line-height: 1;
            display: block;
        }

        .news-content h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        /* ════════════════════════════════════════════════════════════════════════════
           FOOTER
           ════════════════════════════════════════════════════════════════════════════ */
        footer {
            background: var(--primary);
            color: white;
            padding: 5rem 0 2rem;
            margin-top: 4rem;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr;
            gap: 4rem;
            margin-bottom: 4rem;
        }

        .footer-brand h2 {
            color: white;
            margin-bottom: 1.5rem;
        }

        .footer-brand p {
            color: #94A3B8;
            max-width: 300px;
        }

        .footer-links h4 {
            color: white;
            margin-bottom: 1.5rem;
        }

        .footer-links ul li {
            margin-bottom: 0.8rem;
        }

        .footer-links a {
            color: #94A3B8;
        }

        .footer-links a:hover {
            color: white;
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 2rem;
            text-align: center;
            color: #64748B;
            font-size: 0.9rem;
        }

        /* ════════════════════════════════════════════════════════════════════════════
           MOBILE
           ════════════════════════════════════════════════════════════════════════════ */
        @media (max-width: 768px) {
            .hero-content {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 2rem;
            }

            .hero-text h1 {
                font-size: 2.5rem;
            }

            .cta-group {
                justify-content: center;
            }

            .hero-stats {
                grid-template-columns: 1fr;
            }

            .stat-card:nth-child(2) {
                transform: none;
            }

            .nav-links {
                display: none;
            }

            .mobile-toggle {
                display: block;
            }

            .news-item {
                grid-template-columns: 1fr;
                height: auto;
            }

            .news-date {
                padding: 1rem;
                flex-direction: row;
                gap: 1rem;
                height: auto;
            }

            .news-date b {
                display: inline;
                font-size: 1rem;
            }
        }
    </style>
</head>

<body>

    <!-- NAVIGATION -->
    <header id="header">
        <div class="container nav-wrapper">
            <a href="#" class="logo">
                <div class="logo-icon"><i class="fa-solid fa-robot"></i></div>
                <span>ISTUN Mechatronics</span>
            </a>
            <nav class="nav-links">
                <a href="#about" class="nav-link">About</a>
                <a href="#research" class="nav-link">Research</a>
                <a href="#faculty" class="nav-link">People</a>
                <a href="#projects" class="nav-link">Projects</a>
                <a href="#news" class="nav-link">News</a>
            </nav>
            <a href="#contact" class="btn btn-primary" style="padding: 0.6rem 1.2rem; font-size: 0.9rem;">Apply Now</a>
        </div>
    </header>

    <!-- HERO SECTION -->
    <section class="hero">
        <div class="hero-mesh"></div>
        <div class="container hero-content">
            <div class="hero-text reveal">
                <h1 id="heroTitle">Pioneering the Future of <br><span>Intelligent Systems</span></h1>
                <p id="heroSubtitle">Fetching world-class engineering data...</p>
                <div class="cta-group">
                    <a href="#research" class="btn">Explore Research <i class="fa-solid fa-arrow-right"></i></a>
                    <a href="#video" class="btn btn-outline"><i class="fa-solid fa-play"></i> Watch Video</a>
                </div>
            </div>

            <div class="hero-stats" id="heroStats">
                <!-- Skeleton Stats -->
                <div class="stat-card skeleton" style="height: 180px;"></div>
                <div class="stat-card skeleton" style="height: 180px;"></div>
            </div>
        </div>
    </section>

    <!-- RESEARCH SECTION -->
    <section id="research" class="section">
        <div class="container">
            <div class="section-header reveal">
                <span class="label">Research Areas</span>
                <h2>Driving Innovation</h2>
                <p style="color:var(--text-muted); font-size:1.1rem;">Our labs are at the forefront of robotics,
                    automation, and sustainable energy.</p>
            </div>

            <div class="grid-3" id="researchGrid">
                <div class="research-card skeleton" style="height:400px;"></div>
                <div class="research-card skeleton" style="height:400px;"></div>
                <div class="research-card skeleton" style="height:400px;"></div>
            </div>
        </div>
    </section>

    <!-- FACULTY SECTION -->
    <section id="faculty" class="section" style="background: white;">
        <div class="container">
            <div class="section-header reveal">
                <span class="label">Our Team</span>
                <h2>Meet the Experts</h2>
            </div>

            <div class="faculty-scroller" id="facultyList">
                <div class="faculty-card skeleton" style="width:280px; height:350px;"></div>
                <div class="faculty-card skeleton" style="width:280px; height:350px;"></div>
                <div class="faculty-card skeleton" style="width:280px; height:350px;"></div>
                <div class="faculty-card skeleton" style="width:280px; height:350px;"></div>
            </div>
        </div>
    </section>

    <!-- NEWS SECTION -->
    <section id="news" class="section">
        <div class="container" style="max-width: 900px;">
            <div class="section-header reveal" style="text-align: center; margin: 0 auto 4rem;">
                <span class="label">Updates</span>
                <h2>Latest News & Events</h2>
            </div>

            <div id="newsList">
                <div class="news-item skeleton" style="height:150px;"></div>
                <div class="news-item skeleton" style="height:150px;"></div>
            </div>

            <div style="text-align: center; margin-top: 3rem;">
                <a href="#" class="btn btn-outline">View All Archives</a>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer id="contact">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <h2>ISTUN Mechatronics</h2>
                    <p id="footerAddress">Engineering Building, Istanbul.</p>
                    <div style="display:flex; gap:1rem; margin-top:1.5rem;">
                        <a href="#"><i class="fa-brands fa-twitter"></i></a>
                        <a href="#"><i class="fa-brands fa-linkedin"></i></a>
                        <a href="#"><i class="fa-brands fa-instagram"></i></a>
                    </div>
                </div>
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#">Undergraduate</a></li>
                        <li><a href="#">Graduate Program</a></li>
                        <li><a href="#">Research Labs</a></li>
                        <li><a href="#">Apply</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>Contact</h4>
                    <ul id="footerContact">
                        <li>Loading...</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                &copy; 2026 Istanbul Health and Technology University. All Rights Reserved.
            </div>
        </div>
    </footer>

    <script>
        // ═══════════════════════════════════════════════════════════════════════════
        // CORE DATA LOGIC (ROBUST CSV PARSER)
        // ═══════════════════════════════════════════════════════════════════════════
        const DATA = { settings: {}, news: [], research: [], faculty: [], events: [] };

        // Cache bust to prevent stale content
        const CACHE_BUST = Date.now();

        function getSheetURL(tabName) {
            // Headers=0 ensures we get ALL rows without Google guessing headers
            return `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(tabName)}&headers=0&cb=${CACHE_BUST}`;
        }

        /* 
           Parses CSV handling newlines inside quoted cells. 
           If returnRaw is true, returns array of arrays (good for Settings sheet).
           If returnRaw is false, returns array of objects using first row as headers.
        */
        function parseCSV(csvText, returnRaw = false) {
            const rows = [];
            let currentRow = [];
            let currentVal = '';
            let inQuotes = false;

            // Normalize line endings
            const csv = csvText.replace(/\r\n/g, '\n').replace(/\r/g, '\n');

            for (let i = 0; i < csv.length; i++) {
                const char = csv[i];
                const nextChar = csv[i + 1];

                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        currentVal += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    currentRow.push(currentVal.trim());
                    currentVal = '';
                } else if (char === '\n' && !inQuotes) {
                    currentRow.push(currentVal.trim());
                    if (currentRow.length > 0) rows.push(currentRow);
                    currentRow = [];
                    currentVal = '';
                } else {
                    currentVal += char;
                }
            }
            if (currentVal || currentRow.length) {
                currentRow.push(currentVal.trim());
                if (currentRow.length > 0) rows.push(currentRow);
            }

            if (returnRaw) return rows;
            if (rows.length < 2) return [];

            const headers = rows[0];
            const data = [];
            for (let i = 1; i < rows.length; i++) {
                const values = rows[i];
                const row = {};
                headers.forEach((h, idx) => {
                    const key = h.toLowerCase().replace(/\s+/g, '_');
                    row[key] = values[idx] || '';
                });
                data.push(row);
            }
            return data;
        }

        async function fetchSheet(tabName, isSettings = false) {
            try {
                const response = await fetch(getSheetURL(tabName), { cache: 'no-store' });
                if (!response.ok) throw new Error('Failed to fetch');
                const csv = await response.text();
                return parseCSV(csv, isSettings);
            } catch (err) {
                console.error(`Error fetching ${tabName}:`, err);
                return [];
            }
        }

        // Specialized function to handle the vertical layout of Settings sheet
        async function fetchSettings() {
            try {
                // Fetch raw rows
                const rows = await fetchSheet(SHEETS.settings, true);
                const settings = {};

                rows.forEach(row => {
                    if (!row || row.length < 2) return;

                    // Handle split cells (Alt+Enter in Google Sheets)
                    const keyCell = row[0] || '';
                    const valCell = row[1] || '';

                    if (keyCell.includes('\n') || valCell.includes('\n')) {
                        const keys = keyCell.split('\n');
                        const vals = valCell.split('\n');
                        const count = Math.max(keys.length, vals.length);
                        for (let i = 0; i < count; i++) {
                            const k = (keys[i] || '').trim();
                            const v = (vals[i] || '').trim();
                            if (k && k !== 'key') settings[k] = v;
                        }
                    } else {
                        if (keyCell !== 'key') settings[keyCell] = valCell;
                    }
                });
                return settings;
            } catch (err) {
                return {};
            }
        }

        // ═══════════════════════════════════════════════════════════════════════════
        // UI RENDERING
        // ═══════════════════════════════════════════════════════════════════════════

        function t(en, tr) { return en; } // Default to English for World Class design for now

        function render() {
            // Settings
            const s = DATA.settings;
            document.getElementById('heroTitle').innerHTML = s.hero_title_en || 'Pioneering the Future of <br><span>Intelligent Systems</span>';
            document.getElementById('heroSubtitle').textContent = s.hero_subtitle_en || 'Department of Mechatronics Engineering';

            // Stats in Hero
            document.getElementById('heroStats').innerHTML = `
            <div class="stat-card">
                <span class="stat-value">${s.stat_grants}</span>
                <div class="stat-label">Active Research Grants</div>
            </div>
            <div class="stat-card">
                <span class="stat-value">${s.stat_faculty}</span>
                <div class="stat-label">Faculty Members</div>
            </div>
        `;

            // Footer Data
            document.getElementById('footerAddress').textContent = s.address;
            document.getElementById('footerContact').innerHTML = `
             <li>${s.email}</li>
             <li>${s.phone}</li>
        `;

            // Research
            const researchHTML = DATA.research.slice(0, 3).map(r => `
            <div class="research-card">
                <div class="research-img" style="background-image: url('${r.image || 'https://images.unsplash.com/photo-1581093458791-9f3c3900df4b?w=600&q=80'}')">
                    <span class="research-badge">${r.type || 'Lab'}</span>
                </div>
                <div class="research-content">
                    <h3>${r.name_en || r.name}</h3>
                    <p>${r.description_en || r.description}</p>
                    <div class="research-meta">
                        <span class="research-lead"><img src="https://ui-avatars.com/api/?name=${r.lead}&background=0F172A&color=fff" alt=""> ${r.lead}</span>
                        <a href="#" style="color:var(--accent); font-weight:600;">View Lab <i class="fa-solid fa-arrow-right"></i></a>
                    </div>
                </div>
            </div>
        `).join('');
            document.getElementById('researchGrid').innerHTML = researchHTML;

            // Faculty
            const facultyHTML = DATA.faculty.map(f => `
            <div class="faculty-card">
                <img src="${f.photo || `https://ui-avatars.com/api/?name=${f.name}&background=random&size=200`}" class="faculty-img" alt="${f.name}">
                <h3 class="faculty-name">${f.name}</h3>
                <div class="faculty-role">${f.title}</div>
                <p style="font-size:0.9rem; color:var(--text-muted);">${f.research_en || f.research}</p>
            </div>
        `).join('');
            document.getElementById('facultyList').innerHTML = facultyHTML;

            // News
            const newsHTML = DATA.news.slice(0, 3).map(n => {
                const date = new Date(n.date);
                const month = date.toLocaleString('default', { month: 'short' });
                return `
            <div class="news-item">
                <div class="news-date">
                    <b>${date.getDate()}</b>
                    <span>${month}</span>
                </div>
                <div class="news-content">
                    <span style="color:var(--accent); font-weight:600; font-size:0.85rem;">${n.category}</span>
                    <h3>${n.title_en || n.title}</h3>
                    <p style="color:var(--text-muted);">${n.description_en || n.description}</p>
                </div>
            </div>
            `;
            }).join('');
            document.getElementById('newsList').innerHTML = newsHTML;

            // Trigger scroll animations
            observeElements();
        }

        async function init() {
            try {
                [
                    DATA.settings,
                    DATA.news,
                    DATA.research,
                    DATA.faculty
                ] = await Promise.all([
                    fetchSettings(), // Vital: call the specific settings parser
                    fetchSheet(SHEETS.news),
                    fetchSheet(SHEETS.research),
                    fetchSheet(SHEETS.faculty)
                ]);

                render();

            } catch (e) {
                console.error('Init error:', e);
            }
        }

        // ═══════════════════════════════════════════════════════════════════════════
        // INTERACTIONS
        // ═══════════════════════════════════════════════════════════════════════════

        // Sticky Header
        window.addEventListener('scroll', () => {
            const header = document.getElementById('header');
            if (window.scrollY > 50) header.classList.add('scrolled');
            else header.classList.remove('scrolled');
        });

        // Scroll Animations
        function observeElements() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('active');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        }

        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>

</html>